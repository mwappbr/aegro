# Story 3.5: Filtrar e Ordenar Tarefas

## Status
Draft

## Story
**As a** usuário,  
**I want** filtrar e ordenar minhas tarefas,  
**so that** eu possa encontrar tarefas específicas rapidamente

## Acceptance Criteria
1. Filtro por status: dropdown com opções (Todos, Pendentes, Em Progresso, Concluídas)
2. Filtro por prioridade: dropdown (Todos, Baixa, Média, Alta)
3. Filtro por projeto: dropdown com lista de projetos (Todos, Projeto 1, Projeto 2, ...)
4. Filtros podem ser combinados (ex: Pendentes + Alta prioridade + Projeto X)
5. Ordenação: dropdown com opções (Data de criação, Data de vencimento, Prioridade, Título)
6. Ordenação ascendente/descendente (mais recente primeiro ou mais antiga primeiro)
7. Filtros e ordenação persistem durante a sessão (ou resetam ao recarregar)
8. Contador mostra quantas tarefas correspondem aos filtros aplicados

## Tasks / Subtasks
- [ ] Task 1: Setup Backend - Endpoint com Filtros e Ordenação (AC: 1, 2, 3, 4, 5, 6)
  - [ ] Atualizar rota GET `/api/tasks` em `server/src/routes/tasks.routes.ts` para aceitar query parameters [Source: architecture/4-design-da-api.md#tarefas]
  - [ ] Atualizar função `getTasks()` em `server/src/services/task.service.ts` para:
    - Aceitar query parameters: status, priority, projectId, search, sort, order
    - Aplicar filtros via Prisma where clause
    - Aplicar ordenação via Prisma orderBy
    - Retornar lista filtrada e ordenada
  - [ ] Validar query parameters (valores válidos para status, priority, sort, order)
- [ ] Task 2: Setup Frontend - Componente FilterBar (AC: 1, 2, 3, 4, 5, 6, 7)
  - [ ] Criar componente `FilterBar` em `client/src/components/FilterBar/FilterBar.tsx` [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
  - [ ] Adicionar dropdowns:
    - Status: Todos, Pendentes, Em Progresso, Concluídas
    - Prioridade: Todos, Baixa, Média, Alta
    - Projeto: Todos + lista de projetos (carregar de Story 2.2)
    - Ordenação: Data de criação, Data de vencimento, Prioridade, Título
    - Ordem: Ascendente, Descendente
  - [ ] Implementar estado local para filtros e ordenação
  - [ ] Persistir filtros no localStorage (opcional) ou resetar ao recarregar
  - [ ] Atualizar TaskList quando filtros mudam (chamar API com novos parâmetros)
- [ ] Task 3: Integração com TaskList (AC: 4, 8)
  - [ ] Atualizar TaskList para aceitar filtros como props ou estado
  - [ ] Atualizar função `getTasks()` em `client/src/api/tasks.ts` para aceitar query parameters [Source: architecture/6-arquitetura-de-componentes-react.md#63-padro-do-cliente-api]
  - [ ] Implementar contador de tarefas filtradas
  - [ ] Atualizar lista quando filtros mudam
- [ ] Task 4: Integração no Dashboard (AC: 7)
  - [ ] Integrar FilterBar no DashboardPage acima da TaskList
  - [ ] Conectar filtro de projeto com seleção de projeto (Story 2.2)
  - [ ] Sincronizar filtro de projeto com projeto selecionado na sidebar
- [ ] Task 5: Integração e Testes (AC: Todos)
  - [ ] Testar todos os filtros individualmente
  - [ ] Testar combinação de filtros
  - [ ] Testar todas as opções de ordenação
  - [ ] Testar ordenação ascendente/descendente
  - [ ] Testar contador de tarefas
  - [ ] Testar persistência de filtros (se implementada)

## Dev Notes

### Previous Story Insights
- Story 3.1 criou TaskList para exibir tarefas
- Story 2.2 criou lista de projetos que pode ser usada no filtro
- Reutilizar estrutura de rotas/services de tarefas
- Preparar para integração com seleção de projeto na sidebar

### Data Models
**Task Model** [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- Mesmo modelo das stories anteriores
- Campos para filtro: status, priority, projectId
- Campos para ordenação: createdAt, dueDate, priority, title

**Query Parameters** [Source: architecture/4-design-da-api.md#tarefas]
```typescript
interface TaskFilters {
  status?: 'pending' | 'in_progress' | 'completed';
  priority?: 'low' | 'medium' | 'high';
  projectId?: number;
  search?: string; // Busca em título e descrição
  sort?: 'createdAt' | 'dueDate' | 'priority' | 'title';
  order?: 'asc' | 'desc';
}
```

### API Specifications
**GET /api/tasks** [Source: architecture/4-design-da-api.md#tarefas]
- **Autenticação**: Requerida (JWT token)
- **Request Headers**: `Authorization: Bearer <token>`
- **Query Parameters**:
  - `status`: `pending` | `in_progress` | `completed` | (vazio = todos)
  - `priority`: `low` | `medium` | `high` | (vazio = todos)
  - `projectId`: `number` | (vazio = todos)
  - `search`: `string` (busca em título e descrição)
  - `sort`: `createdAt` | `dueDate` | `priority` | `title` (default: `createdAt`)
  - `order`: `asc` | `desc` (default: `desc`)
- **Response 200**: Lista de tarefas filtrada e ordenada
- **Erros**:
  - `400 Bad Request`: Parâmetros inválidos
  - `401 Unauthorized`: Token ausente ou inválido

### Component Specifications
**FilterBar Component** [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
- Localização: `client/src/components/FilterBar/FilterBar.tsx`
- Props:
  - `projects: Project[]` - Lista de projetos para filtro
  - `onFiltersChange: (filters: TaskFilters) => void` - Callback quando filtros mudam
- Estado:
  - `status: TaskStatus | 'all'`
  - `priority: TaskPriority | 'all'`
  - `projectId: number | null`
  - `sort: 'createdAt' | 'dueDate' | 'priority' | 'title'`
  - `order: 'asc' | 'desc'`
- Renderização:
  - Dropdowns para cada filtro
  - Dropdowns para ordenação e ordem
  - Botão "Limpar Filtros" (opcional)

**TaskList Update** [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
- Aceitar filtros como props ou estado
- Atualizar quando filtros mudam
- Exibir contador de tarefas filtradas

### File Locations
**Backend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Rota: `server/src/routes/tasks.routes.ts` (atualizar rota GET)
- Service: `server/src/services/task.service.ts` (atualizar função getTasks)

**Frontend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Componente: `client/src/components/FilterBar/FilterBar.tsx` (novo)
- Componente: `client/src/components/TaskList/TaskList.tsx` (atualizar para aceitar filtros)
- API Client: `client/src/api/tasks.ts` (atualizar função getTasks para aceitar query parameters)
- Types: `client/src/types/task.ts` (adicionar TaskFilters)

### Testing Requirements
**Backend Testing**
- Testes unitários para `task.service.getTasks()` com filtros e ordenação
- Testes de integração para rota GET `/api/tasks` com query parameters
- Testar cada filtro individualmente
- Testar combinação de filtros
- Testar todas as opções de ordenação
- Testar ordenação ascendente/descendente
- Testar busca (search parameter)

**Frontend Testing**
- Testes de componente para `FilterBar.tsx`
- Testar todos os dropdowns
- Testar mudança de filtros (callback onFiltersChange)
- Testar integração com TaskList
- Testar contador de tarefas
- Testar persistência de filtros (se implementada)

### Technical Constraints
- **Filtros Combinados**: Todos os filtros podem ser aplicados simultaneamente [Source: architecture/4-design-da-api.md#tarefas]
- **Ordenação**: Default: createdAt DESC (mais recente primeiro) [Source: architecture/4-design-da-api.md#tarefas]
- **Performance**: Índices em status, priority, projectId, dueDate otimizam queries filtradas [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- **Persistência**: Filtros podem persistir no localStorage ou resetar ao recarregar (escolher uma abordagem)

### Project Structure Notes
FilterBar deve seguir padrão de componente por pasta. Integrar com TaskList e sincronizar com seleção de projeto na sidebar (Story 2.2).

## Testing

### Testing Standards
**Test File Location**
- Backend: `server/src/__tests__/` ou próximo aos arquivos
- Frontend: `client/src/__tests__/` ou próximo aos componentes

**Testing Frameworks**
- Backend: Jest
- Frontend: React Testing Library

**Testing Patterns**
- Testes unitários para services com filtros
- Testes de integração para rotas com query parameters
- Testes de componente para FilterBar e TaskList

**Specific Testing Requirements for This Story**
- Validar todos os filtros individualmente
- Validar combinação de filtros
- Validar todas as opções de ordenação
- Validar ordenação ascendente/descendente
- Validar contador de tarefas
- Validar busca (search parameter)
- Validar persistência de filtros (se implementada)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-XX | 1.0 | Story criada | Scrum Master |

## Dev Agent Record
*Esta seção será preenchida pelo agente de desenvolvimento durante a implementação*

### Agent Model Used
*A ser preenchido*

### Debug Log References
*A ser preenchido*

### Completion Notes List
*A ser preenchido*

### File List
*A ser preenchido*

## QA Results
*Esta seção será preenchida pelo agente QA após revisão*
