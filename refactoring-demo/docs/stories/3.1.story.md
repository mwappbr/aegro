# Story 3.1: Visualizar Lista de Tarefas

## Status
Draft

## Story
**As a** usuário,  
**I want** ver todas as minhas tarefas,  
**so that** eu possa acompanhar meu trabalho

## Acceptance Criteria
1. Lista de tarefas exibida em formato de cards ou tabela
2. Cada tarefa mostra: título, status, prioridade, data de vencimento, projeto
3. Tarefas atrasadas destacadas visualmente (cor vermelha, ícone)
4. Status exibido com badge colorido (pending=cinza, in_progress=azul, completed=verde)
5. Prioridade exibida com ícone ou cor (low=verde, medium=amarelo, high=vermelho)
6. Estado vazio quando não há tarefas
7. Lista atualizada após criar/editar/excluir tarefa

## Tasks / Subtasks
- [ ] Task 1: Setup Backend - Endpoint de Listar Tarefas (AC: 1, 2)
  - [ ] Criar arquivo `server/src/routes/tasks.routes.ts` com rota GET `/api/tasks`
  - [ ] Criar arquivo `server/src/services/task.service.ts` com função `getTasks()` que:
    - Obtém userId do token JWT (via middleware auth)
    - Busca tarefas do usuário via Prisma (where createdById = userId OU assignedToId = userId)
    - Inclui relação com projeto (project.name)
    - Retorna lista de tarefas
  - [ ] Aplicar middleware auth na rota
- [ ] Task 2: Setup Frontend - Componente TaskCard (AC: 1, 2, 3, 4, 5)
  - [ ] Criar componente `TaskCard` em `client/src/components/TaskCard/TaskCard.tsx` [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
  - [ ] Componente deve exibir: título, status, prioridade, data de vencimento, projeto
  - [ ] Implementar badge de status com cores (pending=cinza, in_progress=azul, completed=verde)
  - [ ] Implementar indicador de prioridade com cores/ícones (low=verde, medium=amarelo, high=vermelho)
  - [ ] Implementar destaque visual para tarefas atrasadas (cor vermelha, ícone)
  - [ ] Usar Tailwind CSS para estilização [Source: architecture/1-viso-geral-da-arquitetura.md#12-stack-tecnolgica]
- [ ] Task 3: Setup Frontend - Lista de Tarefas (AC: 1, 6, 7)
  - [ ] Criar componente `TaskList` em `client/src/components/TaskList/TaskList.tsx`
  - [ ] Componente deve renderizar lista de TaskCard
  - [ ] Implementar estado vazio quando não há tarefas
  - [ ] Criar função `getTasks()` em `client/src/api/tasks.ts` [Source: architecture/6-arquitetura-de-componentes-react.md#63-padro-do-cliente-api]
  - [ ] Integrar componente com API client
  - [ ] Implementar atualização automática da lista (usar estado ou refetch)
  - [ ] Adicionar loading state durante requisição
- [ ] Task 4: Integração no Dashboard (AC: 7)
  - [ ] Integrar TaskList no DashboardPage
  - [ ] Preparar para atualização da lista quando tarefas são criadas/editadas/excluídas (Stories 3.2, 3.3, 3.4)
- [ ] Task 5: Integração e Testes (AC: Todos)
  - [ ] Testar fluxo completo: carregar tarefas → exibir lista → atualizar após mudanças
  - [ ] Testar exibição de todos os campos
  - [ ] Testar badges de status e prioridade
  - [ ] Testar destaque de tarefas atrasadas
  - [ ] Testar estado vazio
  - [ ] Testar atualização da lista

## Dev Notes

### Previous Story Insights
- Stories 2.1-2.2 criaram estrutura de projetos e middleware de autenticação
- Projetos podem ser listados e selecionados
- Reutilizar middleware auth e padrão de rotas/services

### Data Models
**Task Model (Prisma Schema)** [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
```prisma
model Task {
  id          Int          @id @default(autoincrement())
  title       String
  description String?
  status      TaskStatus   @default(pending)
  priority    TaskPriority @default(medium)
  dueDate     DateTime?
  projectId   Int?
  createdById Int
  assignedToId Int?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  project     Project?    @relation(fields: [projectId], references: [id], onDelete: SetNull)
  createdBy   User         @relation("TaskCreator", fields: [createdById], references: [id])
  assignedTo  User?        @relation("TaskAssignee", fields: [assignedToId], references: [id], onDelete: SetNull)
  
  @@index([createdById])
  @@index([assignedToId])
  @@index([projectId])
  @@index([status])
  @@index([dueDate])
  @@index([status, dueDate]) // Índice composto para queries de tarefas atrasadas
  @@map("tasks")
}

enum TaskStatus {
  pending
  in_progress
  completed
}

enum TaskPriority {
  low
  medium
  high
}
```

**Lógica de Tarefas Atrasadas** [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- Tarefa atrasada: `dueDate < hoje` AND `status != 'completed'`
- Índice composto `[status, dueDate]` otimiza esta query

### API Specifications
**GET /api/tasks** [Source: architecture/4-design-da-api.md#tarefas]
- **Autenticação**: Requerida (JWT token)
- **Request Headers**: `Authorization: Bearer <token>`
- **Query Parameters**: (Para Story 3.5 - Filtrar/Ordenar, por enquanto retornar todas)
- **Response 200**:
  ```json
  {
    "tasks": [
      {
        "id": 1,
        "title": "Design homepage",
        "description": "Create modern design",
        "status": "completed",
        "priority": "high",
        "dueDate": "2026-01-20T00:00:00Z",
        "projectId": 1,
        "createdById": 1,
        "assignedToId": 1,
        "createdAt": "2026-01-15T10:00:00Z",
        "updatedAt": "2026-01-18T10:00:00Z",
        "project": {
          "id": 1,
          "name": "Website Redesign"
        }
      }
    ]
  }
  ```
- **Filtro**: Apenas tarefas do usuário autenticado (createdById = userId OU assignedToId = userId)
- **Erros**:
  - `401 Unauthorized`: Token ausente ou inválido

### Component Specifications
**TaskCard Component** [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
- Localização: `client/src/components/TaskCard/TaskCard.tsx`
- Props:
  - `task: Task` - Objeto tarefa completo
  - `onEdit?: (task: Task) => void` - Callback para editar (Story 3.3)
  - `onDelete?: (taskId: number) => void` - Callback para excluir (Story 3.4)
- Renderização:
  - Título da tarefa
  - Badge de status com cor (pending=cinza, in_progress=azul, completed=verde)
  - Indicador de prioridade com cor/ícone (low=verde, medium=amarelo, high=vermelho)
  - Data de vencimento formatada
  - Nome do projeto (se houver)
  - Destaque visual se tarefa atrasada (cor vermelha, ícone de alerta)

**TaskList Component** [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
- Localização: `client/src/components/TaskList/TaskList.tsx`
- Estado:
  - `tasks: Task[]` - Lista de tarefas
  - `isLoading: boolean` - Estado de carregamento
  - `error: string | null` - Erro se houver
- Renderização:
  - Lista de TaskCard
  - Estado vazio quando não há tarefas
  - Loading state durante carregamento

### File Locations
**Backend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Rota: `server/src/routes/tasks.routes.ts` (novo)
- Service: `server/src/services/task.service.ts` (novo)
- Types: `server/src/types/task.ts` (novo)

**Frontend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Componente: `client/src/components/TaskCard/TaskCard.tsx` (novo)
- Componente: `client/src/components/TaskList/TaskList.tsx` (novo)
- API Client: `client/src/api/tasks.ts` (novo)
- Types: `client/src/types/task.ts` (novo)
- Utils: `client/src/utils/format.ts` (formatar datas)

### Testing Requirements
**Backend Testing**
- Testes unitários para `task.service.getTasks()` (filtro por userId, relação com projeto)
- Testes de integração para rota GET `/api/tasks`
- Testar que apenas tarefas do usuário autenticado são retornadas
- Testar relação com projeto (project.name)

**Frontend Testing**
- Testes de componente para `TaskCard.tsx` (renderização, badges, cores)
- Testes de componente para `TaskList.tsx`
- Testar destaque de tarefas atrasadas
- Testar estado vazio
- Testar integração com API client

### Technical Constraints
- **Filtro**: Apenas tarefas do usuário (createdById OU assignedToId = userId) [Source: architecture/7-arquitetura-de-segurana.md#71-controles-vs-vulnerabilidades-do-legado]
- **Tarefas Atrasadas**: Lógica: `dueDate < hoje` AND `status != 'completed'` [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- **Cores**: Usar Tailwind CSS para badges e indicadores [Source: architecture/1-viso-geral-da-arquitetura.md#12-stack-tecnolgica]
- **Performance**: Índices em createdById, assignedToId, projectId, status, dueDate [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]

### Project Structure Notes
TaskCard e TaskList devem seguir padrão de componente por pasta. Preparar para filtros e ordenação (Story 3.5).

## Testing

### Testing Standards
**Test File Location**
- Backend: `server/src/__tests__/` ou próximo aos arquivos
- Frontend: `client/src/__tests__/` ou próximo aos componentes

**Testing Frameworks**
- Backend: Jest
- Frontend: React Testing Library

**Testing Patterns**
- Testes unitários para services
- Testes de integração para rotas
- Testes de componente para TaskCard e TaskList

**Specific Testing Requirements for This Story**
- Validar filtro por userId (segurança)
- Validar exibição de todos os campos
- Validar badges de status e prioridade com cores corretas
- Validar destaque de tarefas atrasadas
- Validar estado vazio
- Validar atualização da lista

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-XX | 1.0 | Story criada | Scrum Master |

## Dev Agent Record
*Esta seção será preenchida pelo agente de desenvolvimento durante a implementação*

### Agent Model Used
*A ser preenchido*

### Debug Log References
*A ser preenchido*

### Completion Notes List
*A ser preenchido*

### File List
*A ser preenchido*

## QA Results
*Esta seção será preenchida pelo agente QA após revisão*
