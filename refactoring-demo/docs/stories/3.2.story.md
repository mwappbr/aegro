# Story 3.2: Criar Tarefa

## Status
Draft

## Story
**As a** usuário,  
**I want** adicionar novas tarefas,  
**so that** eu possa registrar novos itens de trabalho

## Acceptance Criteria
1. Formulário com campos: título (obrigatório), descrição (opcional), prioridade (dropdown: low/medium/high), data de vencimento (date picker), projeto (dropdown)
2. Validação: título não pode estar vazio
3. Prioridade padrão: "medium" se não selecionada
4. Status padrão: "pending" ao criar
5. Tarefa associada ao usuário logado como criador
6. Tarefa aparece na lista imediatamente após criação
7. Mensagem de sucesso
8. Formulário limpo após criação bem-sucedida

## Tasks / Subtasks
- [ ] Task 1: Setup Backend - Endpoint de Criação de Tarefa (AC: 1, 2, 3, 4, 5)
  - [ ] Adicionar rota POST `/api/tasks` em `server/src/routes/tasks.routes.ts`
  - [ ] Criar arquivo `server/src/validators/task.validator.ts` com schema Zod `createTaskSchema` [Source: architecture/7-arquitetura-de-segurana.md#72-schemas-de-validao-zod]
  - [ ] Implementar função `createTask()` em `server/src/services/task.service.ts` que:
    - Valida dados com Zod
    - Obtém userId do token JWT (via middleware auth)
    - Define createdById = userId
    - Define status = "pending" (padrão)
    - Define priority = "medium" se não fornecido
    - Cria tarefa no banco via Prisma
    - Retorna tarefa criada com relações (project)
  - [ ] Aplicar middleware auth na rota
  - [ ] Adicionar tratamento de erros [Source: architecture/9-estratgia-de-tratamento-de-erros.md#91-middleware-de-erro-servidor]
- [ ] Task 2: Setup Frontend - Formulário de Criar Tarefa (AC: 1, 2, 3, 6, 7, 8)
  - [ ] Criar componente `TaskForm` em `client/src/components/TaskForm/TaskForm.tsx`
  - [ ] Formulário com campos:
    - title (input text, obrigatório)
    - description (textarea, opcional)
    - priority (select dropdown: low/medium/high, padrão: medium)
    - dueDate (date picker, opcional)
    - projectId (select dropdown com lista de projetos, opcional)
  - [ ] Implementar validação client-side: título não pode estar vazio
  - [ ] Criar função `createTask()` em `client/src/api/tasks.ts` [Source: architecture/6-arquitetura-de-componentes-react.md#63-padro-do-cliente-api]
  - [ ] Integrar formulário com API client
  - [ ] Implementar tratamento de erros e mensagens de sucesso [Source: architecture/9-estratgia-de-tratamento-de-erros.md#92-tratamento-de-erro-cliente]
  - [ ] Limpar formulário após criação bem-sucedida
  - [ ] Atualizar lista de tarefas após criação (refetch ou adicionar ao estado)
  - [ ] Adicionar loading state durante requisição
- [ ] Task 3: Integração no Dashboard (AC: 6)
  - [ ] Integrar TaskForm no DashboardPage
  - [ ] Conectar criação de tarefa com atualização da TaskList (Story 3.1)
  - [ ] Carregar lista de projetos para dropdown (Story 2.2)
- [ ] Task 4: Integração e Testes (AC: Todos)
  - [ ] Testar fluxo completo: criar tarefa → validação → sucesso → atualização da lista
  - [ ] Testar casos de erro: título vazio, validação backend
  - [ ] Testar valores padrão (status=pending, priority=medium)
  - [ ] Testar que tarefa é associada ao usuário logado
  - [ ] Testar limpeza do formulário após sucesso

## Dev Notes

### Previous Story Insights
- Story 3.1 criou TaskList e TaskCard para exibir tarefas
- Story 2.2 criou lista de projetos que pode ser usada no dropdown
- Reutilizar estrutura de rotas/services de tarefas e padrão de validação Zod

### Data Models
**Task Model** [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- Mesmo modelo da Story 3.1
- Campos obrigatórios: title, createdById
- Campos opcionais: description, dueDate, projectId, assignedToId
- Valores padrão: status = "pending", priority = "medium"

**Validação Zod para Criação de Tarefa** [Source: architecture/7-arquitetura-de-segurana.md#72-schemas-de-validao-zod]
```typescript
export const createTaskSchema = z.object({
  title: z.string()
    .min(1, 'Título é obrigatório')
    .max(200, 'Título deve ter no máximo 200 caracteres'),
  description: z.string()
    .max(2000, 'Descrição deve ter no máximo 2000 caracteres')
    .optional()
    .nullable(),
  priority: z.enum(['low', 'medium', 'high']).default('medium'),
  dueDate: z.string()
    .datetime('Data inválida')
    .optional()
    .nullable()
    .transform((val) => val ? new Date(val) : null),
  projectId: z.number().int().positive().optional().nullable(),
});
```

### API Specifications
**POST /api/tasks** [Source: architecture/4-design-da-api.md#tarefas]
- **Autenticação**: Requerida (JWT token)
- **Request Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "title": "New Task",
    "description": "Task description (optional)",
    "priority": "medium",
    "dueDate": "2026-01-25T00:00:00Z",
    "projectId": 1
  }
  ```
- **Response 201**: Tarefa criada com relações (project)
- **Erros**:
  - `400 Bad Request`: Dados inválidos (validação Zod falhou)
  - `401 Unauthorized`: Token ausente ou inválido

### Component Specifications
**TaskForm Component** [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
- Localização: `client/src/components/TaskForm/TaskForm.tsx`
- Campos:
  - title: input text (obrigatório)
  - description: textarea (opcional)
  - priority: select dropdown com opções low/medium/high (padrão: medium)
  - dueDate: date picker (opcional)
  - projectId: select dropdown com lista de projetos (opcional, carregar de Story 2.2)
- Validação client-side: título não pode estar vazio
- Callback `onSuccess` para atualizar lista após criação
- Limpar formulário após sucesso

### File Locations
**Backend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Rota: `server/src/routes/tasks.routes.ts` (adicionar rota POST)
- Service: `server/src/services/task.service.ts` (adicionar função createTask)
- Validator: `server/src/validators/task.validator.ts` (novo)

**Frontend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Componente: `client/src/components/TaskForm/TaskForm.tsx` (novo)
- API Client: `client/src/api/tasks.ts` (adicionar função createTask)
- Types: `client/src/types/task.ts` (reutilizar)
- Componentes: `client/src/components/Input/`, `client/src/components/Button/` (reutilizar)

### Testing Requirements
**Backend Testing**
- Testes unitários para `task.service.createTask()` (validação, criação, valores padrão)
- Testes de integração para rota POST `/api/tasks`
- Testar validação Zod (título vazio, título muito longo)
- Testar valores padrão (status=pending, priority=medium)
- Testar que tarefa é associada ao createdById correto
- Testar relação com projeto (projectId)

**Frontend Testing**
- Testes de componente para `TaskForm.tsx`
- Testar validação client-side
- Testar integração com API client
- Testar atualização da lista após criação
- Testar limpeza do formulário após sucesso
- Testar exibição de mensagens de sucesso/erro

### Technical Constraints
- **Valores Padrão**: status = "pending", priority = "medium" [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- **Associação**: Tarefa sempre associada ao usuário que criou (createdById = userId do token) [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- **Validação**: Zod no backend, validação client-side opcional [Source: architecture/7-arquitetura-de-segurana.md#72-schemas-de-validao-zod]
- **Date Picker**: Usar input type="date" ou biblioteca de date picker (ex: react-datepicker)

### Project Structure Notes
TaskForm deve seguir padrão de componente por pasta. Integrar com TaskList para atualização automática após criação.

## Testing

### Testing Standards
**Test File Location**
- Backend: `server/src/__tests__/` ou próximo aos arquivos
- Frontend: `client/src/__tests__/` ou próximo aos componentes

**Testing Frameworks**
- Backend: Jest
- Frontend: React Testing Library

**Testing Patterns**
- Testes unitários para services
- Testes de integração para rotas
- Testes de componente para TaskForm

**Specific Testing Requirements for This Story**
- Validar valores padrão (status=pending, priority=medium)
- Validar associação de tarefa ao createdById correto
- Validar todos os casos de erro (400, 401)
- Validar atualização da lista após criação
- Validar limpeza do formulário após sucesso

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-XX | 1.0 | Story criada | Scrum Master |

## Dev Agent Record
*Esta seção será preenchida pelo agente de desenvolvimento durante a implementação*

### Agent Model Used
*A ser preenchido*

### Debug Log References
*A ser preenchido*

### Completion Notes List
*A ser preenchido*

### File List
*A ser preenchido*

## QA Results
*Esta seção será preenchida pelo agente QA após revisão*
