# Story 2.2: Visualizar Projetos

## Status
Draft

## Story
**As a** usuário,  
**I want** ver todos os meus projetos,  
**so that** eu possa navegar entre eles e filtrar tarefas

## Acceptance Criteria
1. Lista de projetos exibida em sidebar ou dropdown
2. Cada projeto mostra: nome, descrição (se houver), contagem de tarefas
3. Projetos ordenados por data de criação (mais recente primeiro)
4. Opção de clicar em projeto para filtrar tarefas
5. Indicador visual de projeto selecionado/ativo
6. Estado vazio quando usuário não tem projetos

## Tasks / Subtasks
- [ ] Task 1: Setup Backend - Endpoint de Listar Projetos (AC: 1, 2, 3)
  - [ ] Adicionar rota GET `/api/projects` em `server/src/routes/projects.routes.ts`
  - [ ] Implementar função `getProjects()` em `server/src/services/project.service.ts` que:
    - Obtém userId do token JWT (via middleware auth)
    - Busca projetos do usuário via Prisma (where ownerId = userId)
    - Inclui contagem de tarefas (_count.tasks) [Source: architecture/4-design-da-api.md#projetos]
    - Ordena por createdAt DESC (mais recente primeiro)
    - Retorna lista de projetos
  - [ ] Aplicar middleware auth na rota
- [ ] Task 2: Setup Frontend - Lista de Projetos (AC: 1, 2, 3, 4, 5, 6)
  - [ ] Criar componente `ProjectList` em `client/src/components/ProjectList/ProjectList.tsx`
  - [ ] Componente deve exibir lista de projetos com: nome, descrição, contagem de tarefas
  - [ ] Implementar ordenação por data de criação (mais recente primeiro)
  - [ ] Adicionar estado para projeto selecionado/ativo
  - [ ] Implementar callback `onSelectProject(projectId)` para filtrar tarefas
  - [ ] Criar função `getProjects()` em `client/src/api/projects.ts` [Source: architecture/6-arquitetura-de-componentes-react.md#63-padro-do-cliente-api]
  - [ ] Integrar componente com API client
  - [ ] Implementar estado vazio quando não há projetos
  - [ ] Adicionar indicador visual de projeto selecionado (destaque, cor, etc.)
  - [ ] Adicionar loading state durante requisição
- [ ] Task 3: Integração no Dashboard (AC: 1, 4, 5)
  - [ ] Integrar ProjectList no DashboardPage como sidebar ou dropdown
  - [ ] Conectar seleção de projeto com filtro de tarefas (preparar para Story 3.5)
  - [ ] Atualizar lista de projetos quando novo projeto é criado (Story 2.1)
- [ ] Task 4: Integração e Testes (AC: Todos)
  - [ ] Testar fluxo completo: carregar projetos → exibir lista → selecionar projeto
  - [ ] Testar ordenação (mais recente primeiro)
  - [ ] Testar estado vazio
  - [ ] Testar contagem de tarefas
  - [ ] Testar indicador visual de projeto selecionado

## Dev Notes

### Previous Story Insights
- Story 2.1 criou endpoint de criação de projetos e middleware de autenticação
- Projetos são associados ao ownerId do usuário logado
- Reutilizar middleware auth e estrutura de rotas/services de projetos

### Data Models
**Project Model** [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- Mesmo modelo da Story 2.1
- Relação com User (owner) e Task (tasks)
- Índice em ownerId para performance

**Response com Contagem de Tarefas** [Source: architecture/4-design-da-api.md#projetos]
```typescript
{
  "projects": [
    {
      "id": 1,
      "name": "Website Redesign",
      "description": "Complete overhaul...",
      "ownerId": 1,
      "createdAt": "2026-01-15T10:00:00Z",
      "updatedAt": "2026-01-15T10:00:00Z",
      "_count": {
        "tasks": 5
      }
    }
  ]
}
```

### API Specifications
**GET /api/projects** [Source: architecture/4-design-da-api.md#projetos]
- **Autenticação**: Requerida (JWT token)
- **Request Headers**: `Authorization: Bearer <token>`
- **Response 200**:
  ```json
  {
    "projects": [
      {
        "id": 1,
        "name": "Website Redesign",
        "description": "Complete overhaul...",
        "ownerId": 1,
        "createdAt": "2026-01-15T10:00:00Z",
        "updatedAt": "2026-01-15T10:00:00Z",
        "_count": {
          "tasks": 5
        }
      }
    ]
  }
  ```
- **Ordenação**: Por padrão, ordenar por `createdAt DESC` (mais recente primeiro)
- **Filtro**: Apenas projetos do usuário autenticado (ownerId = userId do token)
- **Erros**:
  - `401 Unauthorized`: Token ausente ou inválido

### Component Specifications
**ProjectList Component** [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
- Localização: `client/src/components/ProjectList/ProjectList.tsx`
- Props:
  - `selectedProjectId?: number` - ID do projeto selecionado
  - `onSelectProject: (projectId: number | null) => void` - Callback quando projeto é selecionado
- Estado:
  - `projects: Project[]` - Lista de projetos
  - `isLoading: boolean` - Estado de carregamento
  - `error: string | null` - Erro se houver
- Renderização:
  - Lista de projetos com nome, descrição (se houver), contagem de tarefas
  - Indicador visual para projeto selecionado
  - Estado vazio quando não há projetos
  - Loading state durante carregamento

**Integração no Dashboard** [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
- ProjectList pode ser renderizado como sidebar ou dropdown no DashboardPage
- Seleção de projeto deve atualizar filtro de tarefas (preparar para Story 3.5)

### File Locations
**Backend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Rota: `server/src/routes/projects.routes.ts` (adicionar rota GET)
- Service: `server/src/services/project.service.ts` (adicionar função getProjects)

**Frontend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Componente: `client/src/components/ProjectList/ProjectList.tsx` (novo)
- API Client: `client/src/api/projects.ts` (adicionar função getProjects)
- Types: `client/src/types/project.ts` (reutilizar)
- Página: `client/src/pages/DashboardPage.tsx` (integrar ProjectList)

### Testing Requirements
**Backend Testing**
- Testes unitários para `project.service.getProjects()` (filtro por ownerId, ordenação, contagem)
- Testes de integração para rota GET `/api/projects`
- Testar que apenas projetos do usuário autenticado são retornados
- Testar ordenação por createdAt DESC
- Testar contagem de tarefas (_count.tasks)

**Frontend Testing**
- Testes de componente para `ProjectList.tsx`
- Testar renderização da lista de projetos
- Testar estado vazio
- Testar seleção de projeto (callback onSelectProject)
- Testar indicador visual de projeto selecionado
- Testar integração com API client

### Technical Constraints
- **Filtro**: Apenas projetos do usuário autenticado (segurança - não expor projetos de outros usuários) [Source: architecture/7-arquitetura-de-segurana.md#71-controles-vs-vulnerabilidades-do-legado]
- **Ordenação**: createdAt DESC (mais recente primeiro) conforme AC
- **Contagem**: Usar Prisma `_count` para contagem eficiente de tarefas [Source: architecture/4-design-da-api.md#projetos]
- **Performance**: Índice em ownerId otimiza query [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]

### Project Structure Notes
ProjectList deve seguir padrão de componente por pasta. Integração no Dashboard deve preparar para filtro de tarefas por projeto (Story 3.5).

## Testing

### Testing Standards
**Test File Location**
- Backend: `server/src/__tests__/` ou próximo aos arquivos
- Frontend: `client/src/__tests__/` ou próximo aos componentes

**Testing Frameworks**
- Backend: Jest
- Frontend: React Testing Library

**Testing Patterns**
- Testes unitários para services
- Testes de integração para rotas
- Testes de componente para ProjectList

**Specific Testing Requirements for This Story**
- Validar filtro por ownerId (segurança)
- Validar ordenação por createdAt DESC
- Validar contagem de tarefas
- Validar estado vazio
- Validar seleção de projeto e callback

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-XX | 1.0 | Story criada | Scrum Master |

## Dev Agent Record
*Esta seção será preenchida pelo agente de desenvolvimento durante a implementação*

### Agent Model Used
*A ser preenchido*

### Debug Log References
*A ser preenchido*

### Completion Notes List
*A ser preenchido*

### File List
*A ser preenchido*

## QA Results
*Esta seção será preenchida pelo agente QA após revisão*
