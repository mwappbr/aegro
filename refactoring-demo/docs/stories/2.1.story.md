# Story 2.1: Criar Projeto

## Status
Draft

## Story
**As a** usuário,  
**I want** criar novos projetos,  
**so that** eu possa organizar minhas tarefas por contexto

## Acceptance Criteria
1. Formulário para criar projeto com campos: nome (obrigatório) e descrição (opcional)
2. Validação: nome não pode estar vazio
3. Projeto criado é automaticamente associado ao usuário logado como owner
4. Projeto aparece na lista de projetos após criação
5. Mensagem de sucesso após criação
6. Data de criação registrada automaticamente
7. Redirecionamento ou atualização da lista após criação

## Tasks / Subtasks
- [ ] Task 1: Setup Backend - Endpoint de Criação de Projeto (AC: 1, 2, 3, 6)
  - [ ] Criar arquivo `server/src/routes/projects.routes.ts` com rota POST `/api/projects`
  - [ ] Criar arquivo `server/src/validators/project.validator.ts` com schema Zod `createProjectSchema` [Source: architecture/7-arquitetura-de-segurana.md#72-schemas-de-validao-zod]
  - [ ] Criar arquivo `server/src/services/project.service.ts` com função `createProject()` que:
    - Valida dados com Zod
    - Obtém userId do token JWT (via middleware auth)
    - Cria projeto no banco via Prisma associado ao ownerId
    - Retorna projeto criado
  - [ ] Criar middleware de autenticação JWT em `server/src/middleware/auth.ts` [Source: architecture/5-fluxo-de-autenticao.md]
  - [ ] Aplicar middleware auth na rota de projetos
  - [ ] Adicionar tratamento de erros [Source: architecture/9-estratgia-de-tratamento-de-erros.md#91-middleware-de-erro-servidor]
- [ ] Task 2: Setup Frontend - Formulário de Criar Projeto (AC: 1, 2, 4, 5, 7)
  - [ ] Criar componente `ProjectForm` em `client/src/components/ProjectForm/ProjectForm.tsx`
  - [ ] Formulário com campos: name (obrigatório), description (opcional)
  - [ ] Implementar validação client-side: nome não pode estar vazio
  - [ ] Criar função `createProject()` em `client/src/api/projects.ts` [Source: architecture/6-arquitetura-de-componentes-react.md#63-padro-do-cliente-api]
  - [ ] Integrar formulário com API client
  - [ ] Implementar tratamento de erros e mensagens de sucesso [Source: architecture/9-estratgia-de-tratamento-de-erros.md#92-tratamento-de-erro-cliente]
  - [ ] Atualizar lista de projetos após criação (ou redirecionar)
  - [ ] Adicionar loading state durante requisição
- [ ] Task 3: Integração e Testes (AC: Todos)
  - [ ] Testar fluxo completo: criar projeto → validação → sucesso → atualização da lista
  - [ ] Testar casos de erro: nome vazio, validação backend
  - [ ] Verificar que projeto é associado ao usuário logado
  - [ ] Verificar que data de criação é registrada automaticamente

## Dev Notes

### Previous Story Insights
- Stories 1.1-1.3 estabeleceram autenticação JWT e AuthContext
- Token JWT está disponível no localStorage
- Middleware de autenticação precisa ser criado para proteger rotas
- Reutilizar padrão de validação Zod e estrutura de rotas/services

### Data Models
**Project Model (Prisma Schema)** [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
```prisma
model Project {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  ownerId     Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  owner User   @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  tasks Task[]
  
  @@index([ownerId])
  @@map("projects")
}
```

**Validação Zod para Criação de Projeto** [Source: architecture/7-arquitetura-de-segurana.md#72-schemas-de-validao-zod]
```typescript
export const createProjectSchema = z.object({
  name: z.string()
    .min(1, 'Nome do projeto é obrigatório')
    .max(200, 'Nome deve ter no máximo 200 caracteres'),
  description: z.string()
    .max(1000, 'Descrição deve ter no máximo 1000 caracteres')
    .optional()
    .nullable(),
});
```

### API Specifications
**POST /api/projects** [Source: architecture/4-design-da-api.md#projetos]
- **Autenticação**: Requerida (JWT token)
- **Request Headers**: `Authorization: Bearer <token>`
- **Request Body**:
  ```json
  {
    "name": "New Project",
    "description": "Project description (optional)"
  }
  ```
- **Response 201**:
  ```json
  {
    "project": {
      "id": 1,
      "name": "New Project",
      "description": "Project description",
      "ownerId": 1,
      "createdAt": "2026-01-15T10:00:00Z",
      "updatedAt": "2026-01-15T10:00:00Z"
    }
  }
  ```
- **Erros**:
  - `400 Bad Request`: Dados inválidos (validação Zod falhou)
  - `401 Unauthorized`: Token ausente ou inválido

**Middleware de Autenticação** [Source: architecture/5-fluxo-de-autenticao.md]
- Middleware deve verificar token JWT no header `Authorization: Bearer <token>`
- Validar token e extrair userId
- Adicionar `req.user = { id: userId }` para uso nas rotas
- Retornar 401 se token inválido ou ausente

### Component Specifications
**ProjectForm Component** [Source: architecture/6-arquitetura-de-componentes-react.md#61-rvore-de-componentes]
- Localização: `client/src/components/ProjectForm/ProjectForm.tsx`
- Campos: name (input text, obrigatório), description (textarea, opcional)
- Validação client-side: nome não pode estar vazio
- Integração com `client/src/api/projects.ts`
- Callback `onSuccess` para atualizar lista após criação

**API Client Pattern** [Source: architecture/6-arquitetura-de-componentes-react.md#63-padro-do-cliente-api]
- Função `createProject()` em `client/src/api/projects.ts`
- Incluir token do localStorage no header Authorization
- Usar `apiRequest()` helper se disponível

### File Locations
**Backend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Rota: `server/src/routes/projects.routes.ts` (novo)
- Service: `server/src/services/project.service.ts` (novo)
- Validator: `server/src/validators/project.validator.ts` (novo)
- Middleware: `server/src/middleware/auth.ts` (novo - middleware JWT)

**Frontend** [Source: architecture/2-estrutura-do-projeto.md#21-estrutura-de-diretrios]
- Componente: `client/src/components/ProjectForm/ProjectForm.tsx` (novo)
- API Client: `client/src/api/projects.ts` (novo)
- Types: `client/src/types/project.ts` (novo)
- Componentes: `client/src/components/Input/`, `client/src/components/Button/` (reutilizar)

### Testing Requirements
**Backend Testing**
- Testes unitários para `project.service.createProject()` (validação, criação, associação ao owner)
- Testes de integração para rota POST `/api/projects`
- Testar middleware de autenticação (token válido, token inválido, token ausente)
- Testar validação Zod (nome vazio, nome muito longo)
- Testar que projeto é associado ao userId correto
- Verificar que createdAt é preenchido automaticamente

**Frontend Testing**
- Testes de componente para `ProjectForm.tsx`
- Testar validação client-side
- Testar integração com API client
- Testar atualização da lista após criação
- Testar exibição de mensagens de sucesso/erro

### Technical Constraints
- **Autenticação**: Todas as rotas de projetos requerem JWT token válido [Source: architecture/5-fluxo-de-autenticao.md]
- **Ownership**: Projeto sempre associado ao usuário que criou (ownerId = userId do token) [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]
- **Validação**: Zod no backend, validação client-side opcional [Source: architecture/7-arquitetura-de-segurana.md#72-schemas-de-validao-zod]
- **Timestamps**: createdAt e updatedAt gerenciados automaticamente pelo Prisma [Source: architecture/3-design-do-banco-de-dados.md#31-schema-prisma]

### Project Structure Notes
Middleware de autenticação deve ser criado em `server/src/middleware/auth.ts` e aplicado nas rotas de projetos. ProjectForm deve seguir padrão de componente por pasta.

## Testing

### Testing Standards
**Test File Location**
- Backend: `server/src/__tests__/` ou próximo aos arquivos
- Frontend: `client/src/__tests__/` ou próximo aos componentes

**Testing Frameworks**
- Backend: Jest
- Frontend: React Testing Library

**Testing Patterns**
- Testes unitários para services
- Testes de integração para rotas (incluindo middleware)
- Testes de componente para ProjectForm

**Specific Testing Requirements for This Story**
- Validar middleware de autenticação JWT
- Validar associação de projeto ao ownerId correto
- Validar timestamps automáticos (createdAt)
- Validar todos os casos de erro (400, 401)
- Validar atualização da lista após criação

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-XX | 1.0 | Story criada | Scrum Master |

## Dev Agent Record
*Esta seção será preenchida pelo agente de desenvolvimento durante a implementação*

### Agent Model Used
*A ser preenchido*

### Debug Log References
*A ser preenchido*

### Completion Notes List
*A ser preenchido*

### File List
*A ser preenchido*

## QA Results
*Esta seção será preenchida pelo agente QA após revisão*
